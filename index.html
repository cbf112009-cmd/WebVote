<!DOCTYPE html>
<html lang="zh-TW">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>UniGov | çµ‚æ¥µå»ä¸­å¿ƒåŒ–æ²»ç†å¹³å°</title>

    <!-- å¤–éƒ¨åº«è¼‰å…¥ -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/ethers/5.7.2/ethers.umd.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.6.0/dist/confetti.browser.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/sortablejs@1.15.0/Sortable.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <link href="https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:wght@400;600;800&display=swap" rel="stylesheet">

    <style>
        :root {
            --p: #6366f1; --p-dark: #4f46e5; --bg: #0b0f1a; --glass: rgba(255, 255, 255, 0.03);
            --border: rgba(255, 255, 255, 0.1); --text: #f8fafc; --muted: #94a3b8;
            --success: #10b981; --error: #ef4444; --warning: #f1c40f;
        }

        * { box-sizing: border-box; transition: 0.3s cubic-bezier(0.4, 0, 0.2, 1); }
        body {
            font-family: 'Plus Jakarta Sans', sans-serif; background: var(--bg); color: var(--text);
            margin: 0; min-height: 100vh; background-image: radial-gradient(circle at 50% -20%, #1e1b4b 0%, var(--bg) 80%);
        }

        /* å°è¦½åˆ— */
        .nav {
            backdrop-filter: blur(12px); background: rgba(11, 15, 26, 0.8);
            padding: 15px 5%; display: flex; align-items: center; gap: 15px;
            position: sticky; top: 0; z-index: 1000; border-bottom: 1px solid var(--border);
        }
        .nav-brand { font-weight: 800; font-size: 1.5rem; color: var(--p); cursor: pointer; }
        .net-badge { font-size: 0.7rem; padding: 4px 10px; border-radius: 50px; background: var(--error); color: white; display: none; }
        .net-ok { background: var(--success); }

        .user-chip { background: var(--glass); border: 1px solid var(--border); padding: 5px 15px; border-radius: 50px; display: flex; align-items: center; gap: 10px; cursor: pointer; }
        .avatar-nav { width: 32px; height: 32px; border-radius: 50%; border: 2px solid var(--p); object-fit: cover; }

        .container { max-width: 1200px; margin: 40px auto; padding: 0 20px 100px; }
        .page { display: none; animation: fadeIn 0.4s ease; }
        .active { display: block; }
        @keyframes fadeIn { from { opacity: 0; transform: translateY(10px); } to { opacity: 1; transform: translateY(0); } }

        .card { background: var(--glass); border: 1px solid var(--border); border-radius: 24px; padding: 30px; margin-bottom: 20px; position: relative; overflow: hidden; }

        /* ç­‰ç´šèˆ‡é€²åº¦ */
        .lvl-container { margin: 25px 0; text-align: left; background: rgba(255,255,255,0.02); padding: 20px; border-radius: 15px; }
        .lvl-bar { width: 100%; height: 16px; background: rgba(0, 0, 0, 0.4); border-radius: 20px; overflow: hidden; border: 1px solid var(--border); margin-top: 10px; }
        .lvl-fill { height: 100%; background: linear-gradient(90deg, #6366f1, #10b981, #f1c40f); width: 0%; transition: 2s ease; }
        .title-wall { display: flex; flex-wrap: wrap; gap: 10px; margin-top: 15px; justify-content: center; }
        .title-badge { background: linear-gradient(135deg, var(--p), #818cf8); color: white; padding: 8px 16px; border-radius: 50px; font-size: 0.85rem; font-weight: 600; box-shadow: 0 4px 15px rgba(99, 102, 241, 0.3); }

        /* åœ“å½¢é ­åƒè¦–è¦º (å¼·åŒ–ç‰ˆ) */
        .cand-img-wrap { width: 180px; height: 180px; overflow: hidden; border-radius: 50%; margin: 0 auto 20px; background: #111; border: 4px solid var(--p); box-shadow: 0 10px 40px rgba(99, 102, 241, 0.2); position: relative; display: flex; align-items: center; justify-content: center; }
        .cand-img { width: 100%; height: 100%; object-fit: cover; }

        button { background: var(--p); color: white; border: none; padding: 12px 20px; border-radius: 12px; cursor: pointer; font-weight: 700; display: flex; align-items: center; gap: 8px; justify-content: center; }
        button:hover { transform: translateY(-2px); box-shadow: 0 5px 15px rgba(99, 102, 241, 0.3); }
        button:disabled { background: var(--muted); cursor: not-allowed; }
        .btn-ghost { background: transparent; border: 1px solid var(--border); color: var(--text); }
        .btn-danger { background: var(--error); }
        .btn-success { background: var(--success); }

        label { display: block; margin-top: 15px; color: var(--muted); font-size: 0.9rem; font-weight: 600; }
        input, select, textarea { width: 100%; padding: 12px; background: rgba(0, 0, 0, 0.3); border: 1px solid var(--border); color: #fff; border-radius: 10px; margin: 8px 0; outline: none; }

        #toast-container { position: fixed; bottom: 30px; right: 30px; z-index: 2000; display: flex; flex-direction: column; gap: 10px; }
        .toast { background: #1e293b; border-left: 4px solid var(--p); color: white; padding: 15px 25px; border-radius: 8px; animation: slideIn 0.3s ease; }
        @keyframes slideIn { from { transform: translateX(100%); } to { transform: translateX(0); } }

        #log { background: #000; color: #10b981; font-family: monospace; padding: 20px; border-radius: 15px; height: 160px; overflow-y: auto; font-size: 13px; border: 1px solid var(--border); line-height: 1.6; }
        
        .edit-card-row { background: rgba(255,255,255,0.02); border: 1px solid var(--border); padding: 15px; border-radius: 15px; margin-bottom: 15px; }
        .edit-flex { display: flex; gap: 10px; align-items: center; }
        .file-label { font-size: 0.8rem; background: var(--p); padding: 5px 10px; border-radius: 5px; cursor: pointer; display: inline-block; margin-top: 5px; }
        
        .qv-info { font-size: 0.85rem; color: var(--warning); margin-top: 5px; font-weight: bold; }
        .sentiment-bar { display: flex; gap: 15px; justify-content: center; margin: 20px 0; }
        .sentiment-btn { background: var(--glass); border: 1px solid var(--border); padding: 10px 20px; border-radius: 50px; cursor: pointer; color: var(--text); font-size: 1.1rem; }
        .sentiment-btn:hover { background: rgba(255,255,255,0.1); transform: scale(1.1); }

        /* æ™‚é–“è¼¸å…¥æ ¼ */
        .time-inputs { display: grid; grid-template-columns: repeat(4, 1fr); gap: 10px; }
        .time-box { text-align: center; }
        .time-box label { margin-top: 5px; margin-bottom: 5px; font-size: 0.75rem; color: var(--muted); }
        .time-box input { text-align: center; padding: 10px; }

        .countdown-wrap { background: rgba(0,0,0,0.3); padding: 10px 20px; border-radius: 15px; display: inline-flex; gap: 15px; border: 1px solid var(--border); margin-top: 10px; }
        .count-unit { display: flex; flex-direction: column; align-items: center; }
        .count-val { font-size: 1.5rem; font-weight: 800; color: var(--warning); }
        .count-lbl { font-size: 0.7rem; color: var(--muted); text-transform: uppercase; }

        /* è¼ªç›¤è¦–è¦ºå¼·åŒ– */
        .wheel-wrap { position: relative; width: 340px; height: 340px; margin: 40px auto; }
        #wheel { width: 100%; height: 100%; border-radius: 50%; border: 10px solid #1e293b; background: conic-gradient(#6366f1 0deg 72deg, #ec4899 72deg 144deg, #06b6d4 144deg 216deg, #f1c40f 216deg 288deg, #10b981 288deg 360deg); transition: transform 4s cubic-bezier(0.15, 0, 0.15, 1); box-shadow: 0 0 50px rgba(99, 102, 241, 0.3); }
        .wheel-pointer { position: absolute; top: -20px; left: 50%; transform: translateX(-50%); width: 0; height: 0; border-left: 20px solid transparent; border-right: 20px solid transparent; border-top: 40px solid var(--error); z-index: 10; filter: drop-shadow(0 5px 5px rgba(0,0,0,0.5)); }
    </style>
</head>

<body>

    <nav class="nav">
        <div class="nav-brand" onclick="showPage('guidePage')"><i class="fa-solid fa-atom"></i> UniGov</div>
        <div id="netStatus" class="net-badge">æ­£åœ¨åµæ¸¬ç¶²è·¯...</div>
        <div style="display:flex; gap:10px;">
            <button class="btn-ghost" onclick="showPage('guidePage')">å¤§å»³å¼•å°</button>
            <button class="btn-ghost" onclick="showPage('listPage')">æ²»ç†å¤§å»³</button>
            <button class="btn-ghost" onclick="showPage('modeInfoPage')">æ¨¡å¼ç™¾ç§‘</button>
            <button class="btn-ghost" onclick="showPage('statPage')">å¯©è¨ˆ/æ’è¡Œ</button>
            <button class="btn-ghost" onclick="showPage('wheelPage')">å¹¸é‹è½‰ç›¤</button>
        </div>
        <div id="userSection" style="margin-left:auto; display:flex; align-items:center; gap:15px;">
            <div id="userInfo" class="user-chip" style="display:none" onclick="showPage('profilePage')">
                <img id="navAvatar" src="" class="avatar-nav">
                <span id="navName">...</span>
                <span id="navRep" style="color:var(--warning); font-weight:bold;">Rep: 0</span>
            </div>
            <button id="connBtn" onclick="connectWalletFlow()"><i class="fa-solid fa-wallet"></i> é€£æ¥éŒ¢åŒ…</button>
            <button id="discoBtn" class="btn-ghost" style="display:none" onclick="disconnectWallet()"><i class="fa-solid fa-right-from-bracket"></i></button>
            <button onclick="showPage('createPage')"><i class="fa-solid fa-plus"></i> ç™¼èµ·ææ¡ˆ</button>
        </div>
    </nav>

    <div class="container">

        <!-- 1. å¼•å°é é¢ (ä¸‰å¤§æ ¸å¿ƒ) -->
        <div id="guidePage" class="page active">
            <div class="card" style="text-align:center; padding:80px 40px;">
                <h1 style="font-size:3.5rem; margin-bottom:20px;">UniGov æ²»ç†ç”Ÿæ…‹å¤§å»³</h1>
                <p style="color:var(--muted); font-size:1.3rem; max-width:850px; margin:0 auto 50px;">
                    é€™æ˜¯ä¸€åº§å»ºç«‹åœ¨ Web3 åŸºç¤ä¸Šçš„æ•¸ä½è­°æœƒã€‚æ•´åˆèº«åˆ†ä¸»æ¬Šã€å¤šç¶­å…±è­˜èˆ‡æ¦®è­½é¤Šæˆã€‚
                </p>
                <div style="display:grid; grid-template-columns: repeat(3, 1fr); gap:30px;">
                    <div class="card" style="border-top: 5px solid var(--p);">
                        <i class="fa-solid fa-id-card fa-3x" style="color:var(--p); margin-bottom:20px;"></i>
                        <h3>èº«åˆ†ä¸»æ¬Šèˆ‡ä¿¡è­½</h3>
                        <p>éŒ¢åŒ…å³èº«åˆ†ã€‚æ‚¨çš„æ¯ä¸€æ¬¡è²¢ç»éƒ½å°‡è½‰åŒ–ç‚ºè²è­½å€¼ (Rep)ï¼Œé€™å°‡æ±ºå®šæ‚¨åœ¨çµ„ç¹”ä¸­çš„å½±éŸ¿åŠ›æ¬Šé‡ï¼Œç¢ºä¿çœŸå¯¦åƒèˆ‡æ¬Šã€‚</p>
                    </div>
                    <div class="card" style="border-top: 5px solid var(--success);">
                        <i class="fa-solid fa-microchip fa-3x" style="color:var(--success); margin-bottom:20px;"></i>
                        <h3>å¤šæ¨¡å¼å…±è­˜è¨ˆç¥¨</h3>
                        <p>å…§å»ºä¸€èˆ¬ã€å¹³æ–¹ã€æ’åºã€å‹Ÿè³‡èˆ‡æ¬Šé‡äº”ç¨®è¨ˆç¥¨æ¨¡å‹ï¼Œéˆæ´»æ‡‰å°å¾è¡Œæ”¿é ç®—åˆ°äººäº‹ä»»å…çš„å„é¡æ±ºç­–å ´æ™¯ã€‚</p>
                    </div>
                    <div class="card" style="border-top: 5px solid var(--warning);">
                        <i class="fa-solid fa-award fa-3x" style="color:var(--warning); margin-bottom:20px;"></i>
                        <h3>æ¦®è­½é¤ŠæˆæŒä¹…åŒ–</h3>
                        <p>æ²»ç†è¡Œç‚ºä¸å†æ¯ç‡¥ã€‚é€éè½‰ç›¤ã€æˆå°±ç‰†èˆ‡ä¿¡è­½ç­‰ç´šï¼Œç²å–çš„æ¯ä¸€ä»½æ¦®è­½éƒ½å°‡èˆ‡æ‚¨çš„éˆä¸Šä½å€æ°¸ä¹…ç¶å®šä¸”æŒä¹…ä¿å­˜ã€‚</p>
                    </div>
                </div>
                <button style="margin:50px auto; padding:18px 50px; font-size:1.2rem;" onclick="showPage('listPage')">é–‹å•Ÿå…±è­˜ä¹‹æ—…</button>
            </div>
        </div>

        <!-- 2. å¤§å»³é é¢ -->
        <div id="listPage" class="page">
            <div style="display:flex; justify-content:space-between; align-items:center; margin-bottom:30px;">
                <h1>éˆä¸Šæ²»ç†è­°æ¡ˆä¸­å¿ƒ</h1>
                <input type="text" id="searchBar" onkeyup="filterPolls()" placeholder="æœå°‹é—œéµå­—..." style="width:300px; margin:0;">
            </div>
            <div id="pollGrid" style="display:grid; grid-template-columns: repeat(auto-fill, minmax(350px, 1fr)); gap:24px;"></div>
        </div>

        <!-- 3. ç™¾ç§‘é é¢ (äº”å¤§æ¨¡å¼ä¸åˆªæ¸›) -->
        <div id="modeInfoPage" class="page">
            <h1>æ²»ç†æ¨¡å¼ç™¾ç§‘å…¨æ›¸</h1>
            <div style="display:grid; gap:25px;">
                <div class="card"><h2>ä¸€èˆ¬æ¨¡å¼ (Standard)</h2><p>æœ€ç´”ç²¹çš„ã€Œä¸€äººä¸€ç¥¨ã€ã€‚</p></div>
                <div class="card"><h2>å¹³æ–¹æŠ•ç¥¨ (Quadratic)</h2><p>æˆæœ¬éš¨ç¥¨æ•¸å¹³æ–¹å¢é•·ï¼Œä¿è­·å°‘æ•¸æ´¾æ„è¦‹è¡¨é”å¼·åº¦ã€‚</p></div>
                <div class="card"><h2>å¹³æ–¹å‹Ÿè³‡ (QF)</h2><p>èšç„¦æ–¼ã€Œåƒèˆ‡äººæ•¸ã€ï¼Œå„ªåŒ–å…¬å…±è²¡é …ç›®çš„åŒ¹é…çé‡‘åˆ†é…ã€‚</p></div>
                <div class="card"><h2>åå¥½æ’åº (Ranked Choice)</h2><p>é€éé¸é …æ’åºé¸å‡ºç¾¤é«”æ¥å—åº¦æœ€é«˜çš„å…¬ç´„æ•¸é¸é …ã€‚</p></div>
                <div class="card"><h2>æ¬Šé‡æŠ•ç¥¨ (Weighted)</h2><p>è©±èªæ¬Šå–æ±ºæ–¼æŒæœ‰çš„æ²»ç†ä»£å¹£æ•¸é‡ã€‚</p></div>
            </div>
        </div>

        <!-- 4. å€‹äººé é¢ -->
        <div id="profilePage" class="page">
            <div class="card" style="max-width:650px; margin:0 auto; text-align:center">
                <h2>æ²»ç†è€…å„€è¡¨æ¿</h2>
                <div id="regAlert" style="background:rgba(239,68,68,0.1); border:1px solid var(--error); padding:15px; border-radius:15px; margin-bottom:20px; display:none;">
                    <b style="color:var(--error);"><i class="fa-solid fa-triangle-exclamation"></i> æ‚¨å°šæœªè¨»å†Šèº«åˆ†</b><br>
                    <button onclick="handleRegisterOnChain()" class="btn-danger" style="margin:10px auto;">ç«‹å³è¨»å†Šæ²»ç†èº«åˆ†</button>
                </div>

                <img id="profileAvatar" src="" style="width:140px; height:140px; border-radius:50%; border:4px solid var(--p); margin: 20px 0; object-fit:cover;">
                
                <div class="lvl-container">
                    <div style="display:flex; justify-content:space-between; margin-bottom:8px;">
                        <b id="lvlTitle" style="color:var(--warning)">è¼‰å…¥ä¸­...</b>
                        <span id="repStatus">Rep: 0</span>
                    </div>
                    <div class="lvl-bar"><div id="lvlFill" class="lvl-fill"></div></div>
                </div>

                <div style="margin-top:20px; border:1px dashed var(--border); padding:20px; border-radius:20px;">
                    <h4><i class="fa-solid fa-trophy"></i> ç¨±è™Ÿæˆå°±æ”¶è—å®¤</h4>
                    <div id="titleCollection" class="title-wall"></div>
                </div>

                <div style="display:flex; gap:15px; margin:30px 0;">
                    <button onclick="handleDailyCheckIn()" style="flex:1; background:var(--success); height:55px;"><i class="fa-solid fa-calendar-check"></i> æ¯æ—¥ç°½åˆ° (+10 Rep)</button>
                    <button onclick="notify('å·²åŒæ­¥æœ¬åœ°æš«å­˜','success')" style="flex:1; height:55px;">æ›´æ–°è³‡æ–™</button>
                </div>
                <button class="btn-danger" style="width:100%;" onclick="disconnectWallet()">
                    <i class="fa-solid fa-right-from-bracket"></i> æ–·é–‹éŒ¢åŒ…é€£æ¥ (å¾¹åº•ç™»å‡º)
                </button>
            </div>
        </div>

        <!-- 5. æ•¸æ“šçœ‹æ¿ -->
        <div id="statPage" class="page">
            <div style="display:grid; grid-template-columns: 1.6fr 1fr; gap:30px;">
                <div>
                    <h1>æ•¸æ“šçµ±è¨ˆçœ‹æ¿</h1>
                    <div class="card"><canvas id="mainChart"></canvas></div>
                    <div id="log">> ç³»çµ±åˆå§‹åŒ–å®Œæˆ...</div>
                </div>
                <div>
                    <h1>é ˜è¢–æ’è¡Œ</h1>
                    <div class="card" id="leaderboardList"></div>
                </div>
            </div>
        </div>

        <!-- 6. å¹¸é‹è½‰ç›¤ (è£œå›ä¸åˆªæ¸›) -->
        <div id="wheelPage" class="page" style="text-align:center">
            <h1>å¹¸é‹æ²»ç†è½‰ç›¤</h1>
            <p style="color:var(--muted); margin-bottom:20px;">æŠ½å–ä»Šæ—¥æ²»ç†é‹å‹¢æˆ–ç¨€æœ‰æˆå°±ç¨±è™Ÿ</p>
            <div class="wheel-wrap">
                <div class="wheel-pointer"></div>
                <div id="wheel"></div>
            </div>
            <button style="margin:30px auto; padding:15px 45px; font-size:1.2rem;" onclick="spinWheel()">å•Ÿå‹•è½‰ç›¤</button>
            <h2 id="wheelResult" style="color:var(--warning); font-size:2rem; min-height:40px;"></h2>
        </div>

        <!-- 7. ç™¼èµ·ææ¡ˆé é¢ -->
        <div id="createPage" class="page">
            <div class="card" style="max-width:800px; margin:0 auto">
                <h2>éƒ¨ç½²æ–°æ²»ç†è­°æ¡ˆ</h2>
                <label>è­°æ¡ˆæ¨™é¡Œ</label>
                <input type="text" id="topic" placeholder="ä¾‹ï¼šèª°æ˜¯ 2026 å¹´åº¦æœ€ä½³æ²»ç†é …ç›®ï¼Ÿ">
                
                <label>æŠ•ç¥¨æ¨¡å¼ (äº”ç¨®ä¸åˆªæ¸›)</label>
                <select id="modeSelect">
                    <option value="0">ä¸€èˆ¬æ¨¡å¼ (Standard)</option>
                    <option value="1">å¹³æ–¹æŠ•ç¥¨ (Quadratic)</option>
                    <option value="2">å¹³æ–¹å‹Ÿè³‡ (QF Matching)</option>
                    <option value="3">åå¥½æ’åº (Ranked Choice)</option>
                    <option value="4">æ¬Šé‡æŠ•ç¥¨ (Weighted Voting)</option>
                </select>

                <div style="margin-top:20px;">
                    <h4>å€™é¸äººè¨­å®š (è²¼ä¸Š Pinata CID/ç¶²å€ æˆ–é›»è…¦ä¸Šå‚³)</h4>
                    <div id="candidateInputsContainer"></div>
                    <button class="btn-ghost" onclick="addCandidateInput()" style="width:100%; margin-top:10px;"><i class="fa-solid fa-plus"></i> æ–°å¢é¸é …</button>
                </div>

                <label>æŠ•ç¥¨æŒçºŒæ™‚é–“ (D:H:M:S)</label>
                <div class="time-inputs">
                    <div class="time-box"><input type="number" id="dur-days" value="0" min="0"><label>å¤©</label></div>
                    <div class="time-box"><input type="number" id="dur-hours" value="1" min="0" max="23"><label>æ™‚</label></div>
                    <div class="time-box"><input type="number" id="dur-mins" value="0" min="0" max="59"><label>åˆ†</label></div>
                    <div class="time-box"><input type="number" id="dur-secs" value="0" min="0" max="59"><label>ç§’</label></div>
                </div>
                
                <button id="submitCreateBtn" onclick="handleCreatePoll()" style="width:100%; margin-top:30px; height:60px; font-size:1.2rem;">ç™¼ä½ˆè‡³ Sepolia</button>
            </div>
        </div>

        <!-- 8. è©³æƒ…é é¢ -->
        <div id="detailPage" class="page">
            <button class="btn-ghost" onclick="showPage('listPage')" style="margin-bottom: 20px;">
                <i class="fa-solid fa-chevron-left"></i> è¿”å›è­°æ¡ˆåˆ—è¡¨
            </button>

            <div id="pollInfo" class="card" style="border-left: 8px solid var(--p);"></div>
            
            <div id="oracleSection" class="card" style="border: 2px solid var(--p); background: rgba(99, 102, 241, 0.05);">
                <h3><i class="fa-solid fa-crystal-ball"></i> æ²»ç†é è¨€æ©Ÿ (Oracle)</h3>
                <p>æŠ¼æ³¨å“ªå€‹å€™é¸äººå°‡å‹å‡ºï¼Ÿé æ¸¬æˆåŠŸå°‡ç²å¾—è²æœ›å€¼åŠ æˆï¼</p>
                <div style="display:flex; gap:10px; margin-top:15px;">
                    <select id="oracleGuess" style="flex:2; margin:0;"></select>
                    <button onclick="handleOracleBet()" class="btn-success" style="flex:1;">ç¢ºèªé æ¸¬</button>
                </div>
            </div>

            <div id="creatorEditSection" class="card" style="display:none; border:2px solid var(--warning); background:rgba(241,196,15,0.05);">
                <h3 style="color:var(--warning);"><i class="fa-solid fa-user-gear"></i> ç™¼èµ·äººç·¨è¼¯é¢æ¿ (0 ç¥¨é™å®š)</h3>
                <label>ä¿®æ”¹æ¨™é¡Œ</label>
                <input type="text" id="editTopic">
                <label>ä¿®æ”¹é¸é …èˆ‡åœ–ç‰‡ (æ”¯æ´ CID/é‡æ–°ä¸Šå‚³)</label>
                <div id="editCandidatesContainer"></div>
                <div style="display:flex; gap:10px; margin-top:15px;">
                    <button onclick="handleEditPollMetadata()" class="btn-success" style="flex:2;"><i class="fa-solid fa-cloud-arrow-up"></i> åŸ·è¡Œéˆä¸Šæ›´æ–°</button>
                    <button onclick="handleDeletePoll()" class="btn-danger" style="flex:1;"><i class="fa-solid fa-trash"></i> åˆªé™¤ææ¡ˆ</button>
                </div>
            </div>

            <div class="card" style="text-align:center">
                <h4>å°æ­¤æ¡ˆçš„ã€Œé«”æ„Ÿæº«åº¦ã€åæ‡‰</h4>
                <div class="sentiment-bar">
                    <div class="sentiment-btn" onclick="notify('ç†±è¡€æ¨™è¨˜æˆåŠŸï¼','success')">ğŸ”¥ ç†±è¡€</div>
                    <div class="sentiment-btn" onclick="notify('å·²æ¨™è¨˜è§€æœ›ã€‚','info')">ğŸ¤” è§€æœ›</div>
                    <div class="sentiment-btn" onclick="notify('çœ‹å¥½æ¨™è¨˜æˆåŠŸï¼','success')">ğŸš€ çœ‹å¥½</div>
                </div>
            </div>

            <div id="qvUserStats" class="card" style="display:none; border:1px solid var(--warning);">
                <p id="remainingCreditsText" style="margin:0; font-weight:bold;">å¯ç”¨é»æ•¸ï¼šè¼‰å…¥ä¸­...</p>
            </div>

            <div id="votingUI" style="display:grid; grid-template-columns: 1fr 1fr; gap:20px;"></div>
        </div>

    </div>

    <div id="toast-container"></div>

    <script>
        const CONTRACT_ADDR = "0xc438c3f6131030Ac5e7070FFFe7434559a9cdd3b"; 
        const ABI = [
            { "inputs": [{ "internalType": "uint256", "name": "_pid", "type": "uint256" }, { "internalType": "uint256", "name": "_cid", "type": "uint256" }, { "internalType": "uint256", "name": "_val", "type": "uint256" }], "name": "castVote", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
            { "inputs": [{ "internalType": "string", "name": "_t", "type": "string" }, { "internalType": "enum UniGov.VotingMode", "name": "_m", "type": "uint8" }, { "internalType": "string[]", "name": "_n", "type": "string[]" }, { "internalType": "string[]", "name": "_u", "type": "string[]" }, { "internalType": "uint256", "name": "_d", "type": "uint256" }], "name": "createPoll", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
            { "inputs": [], "name": "getPollCount", "outputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "stateMutability": "view", "type": "function" },
            { "inputs": [{ "internalType": "uint256", "name": "", "type": "uint256" }], "name": "allPolls", "outputs": [{ "internalType": "uint256", "name": "id", "type": "uint256" }, { "internalType": "address", "name": "creator", "type": "address" }, { "internalType": "string", "name": "topic", "type": "string" }, { "internalType": "enum UniGov.VotingMode", "name": "mode", "type": "uint8" }, { "internalType": "uint256", "name": "endTime", "type": "uint256" }, { "internalType": "bool", "name": "isActive", "type": "bool" }, { "internalType": "uint256", "name": "totalVotes", "type": "uint256" }], "stateMutability": "view", "type": "function" },
            { "inputs": [{ "internalType": "uint256", "name": "_pid", "type": "uint256" }], "name": "getCandidates", "outputs": [{ "components": [{ "internalType": "string", "name": "name", "type": "string" }, { "internalType": "string", "name": "uid", "type": "string" }, { "internalType": "uint256", "name": "voteWeight", "type": "uint256" }], "internalType": "struct UniGov.Candidate[]", "name": "", "type": "tuple[]" }], "stateMutability": "view", "type": "function" },
            { "inputs": [{ "internalType": "address", "name": "_user", "type": "address" }], "name": "getUserDashboard", "outputs": [{ "internalType": "string", "name": "name", "type": "string" }, { "internalType": "uint256", "name": "reputation", "type": "uint256" }, { "internalType": "uint256", "name": "credits", "type": "uint256" }, { "internalType": "bool", "name": "isRegistered", "type": "bool" }], "stateMutability": "view", "type": "function" },
            { "inputs": [{ "internalType": "string", "name": "_name", "type": "string" }, { "internalType": "string", "name": "_avatar", "type": "string" }], "name": "register", "outputs": [], "stateMutability": "nonpayable", "type": "function" },
            { "inputs": [{ "internalType": "uint256", "name": "_pid", "type": "uint256" }, { "internalType": "string", "name": "_newTopic", "type": "string" }, { "internalType": "string[]", "name": "_newNames", "type": "string[]" }, { "internalType": "string[]", "name": "_newUids", "type": "string[]" }], "name": "updatePollMetadata", "outputs": [], "stateMutability": "nonpayable", "type": "function" }
        ];

        let provider, signer, userAddr, contract, userRep = 0, userCredits = 0, userTitles = [], isRegisteredOnChain = false;
        let chartInstance = null, currentPid = null, countdownTimer = null;

        // --- æ ¸å¿ƒä¿®æ­£ï¼šå®‰éœåˆå§‹åŒ–èˆ‡ç™»å‡ºæ„å¿—æ¨™è¨˜ ---
        async function init() {
            if (!window.ethereum) return;
            provider = new ethers.providers.Web3Provider(window.ethereum);

            if (sessionStorage.getItem('explicitLogout') === 'true') {
                document.getElementById("connBtn").style.display = "block";
                document.getElementById("netStatus").innerText = "å°šæœªé€£æ¥éŒ¢åŒ…";
                return;
            }

            try {
                const accounts = await provider.listAccounts();
                if (accounts.length > 0) {
                    await setupSession(accounts[0]);
                } else {
                    document.getElementById("connBtn").style.display = "block";
                    document.getElementById("netStatus").innerText = "å°šæœªé€£æ¥éŒ¢åŒ…";
                }
                
                window.ethereum.on('accountsChanged', (newAccs) => {
                    if (newAccs.length === 0) disconnectWallet();
                    else {
                        sessionStorage.removeItem('explicitLogout');
                        location.reload();
                    }
                });
            } catch (e) { console.warn("Init check pass."); }
        }

        async function connectWalletFlow() {
            try {
                sessionStorage.removeItem('explicitLogout'); 
                const accs = await provider.send("eth_requestAccounts", []);
                if(accs.length > 0) await setupSession(accs[0]);
            } catch (e) { notify("é€£ç·šæˆæ¬Šå¤±æ•—", "error"); }
        }

        async function setupSession(addr) {
            try {
                const network = await provider.getNetwork();
                if (network.chainId !== 11155111) {
                    notify("è«‹åˆ‡æ›è‡³ Sepolia æ¸¬è©¦ç¶²", "info");
                    await window.ethereum.request({ method: 'wallet_switchEthereumChain', params: [{ chainId: "0xaa36a7" }] });
                }
                signer = provider.getSigner();
                userAddr = addr;
                contract = new ethers.Contract(CONTRACT_ADDR, ABI, signer);
                await syncUserDashboard();
                loadPersistedData();
                updateUI();
                renderPolls();
                renderLeaderboard();
                notify("é€£ç·šæˆåŠŸ (Sepolia)", "success");
            } catch (e) { console.error(e); }
        }

        async function syncUserDashboard() {
            if (!contract || !userAddr) return;
            try {
                const dashboard = await contract.getUserDashboard(userAddr);
                isRegisteredOnChain = dashboard.isRegistered;
                userRep = dashboard.reputation.toNumber();
                userCredits = dashboard.credits.toNumber();
                document.getElementById("regAlert").style.display = isRegisteredOnChain ? "none" : "block";
                document.getElementById("netStatus").innerText = "Sepolia å·²é€£æ¥";
                document.getElementById("netStatus").classList.add("net-ok");
                document.getElementById("userInfo").style.display = "flex";
                document.getElementById("connBtn").style.display = "none";
                document.getElementById("discoBtn").style.display = "block";
            } catch (e) { 
                isRegisteredOnChain = false;
                document.getElementById("regAlert").style.display = "block";
                document.getElementById("netStatus").innerText = "å·²é€£ç·š (å°šæœªè¨»å†Š)";
            }
        }

        // --- CID è§£æï¼šåŒ…å« bafk åœ¨å…§çš„æ‰€æœ‰ IPFS æ ¼å¼ ---
        function resolveCandidateImage(uid) {
            if (!uid || uid.length < 5) return `https://api.dicebear.com/7.x/identicon/svg?seed=${uid || 'UniGov'}`;
            uid = uid.trim();
            if (uid.startsWith('data:image')) return uid; 
            const cidRegex = /(Qm[1-9A-HJ-NP-Za-km-z]{44}|b[a-z2-7]{58}|bafy[a-zA-Z0-9]{40,}|bafk[a-zA-Z0-9]{40,})/;
            const match = uid.match(cidRegex);
            if (match) {
                return `https://ipfs.io/ipfs/${match[0]}`;
            }
            if (uid.startsWith('http')) return uid;
            return `https://api.dicebear.com/7.x/identicon/svg?seed=${uid}`;
        }

        async function processImageUpload(input, targetId) {
            const file = input.files[0];
            if (!file) return;
            if (file.size > 500000) return notify("æª”æ¡ˆè«‹å°æ–¼ 500KB","error");
            const reader = new FileReader();
            reader.onload = (e) => {
                document.getElementById(targetId).value = e.target.result;
                notify("æœ¬åœ°åœ–ç‰‡è½‰ç¢¼æˆåŠŸ", "success");
            };
            reader.readAsDataURL(file);
        }

        function addCandidateInput() {
            const container = document.getElementById("candidateInputsContainer");
            const index = container.children.length;
            const div = document.createElement("div"); div.className = "edit-card-row";
            div.innerHTML = `
                <div class="edit-flex"><input type="text" class="cand-name" placeholder="é¸é …åç¨±"><input type="text" id="cand-uid-${index}" class="cand-uid" placeholder="è²¼ä¸Š CID æˆ– Pinata é€£çµ"></div>
                <label class="file-label" for="file-${index}"><i class="fa-solid fa-upload"></i> å¾é›»è…¦ä¸Šå‚³åœ–ç‰‡</label>
                <input type="file" id="file-${index}" style="display:none" accept="image/*" onchange="processImageUpload(this, 'cand-uid-${index}')">`;
            container.appendChild(div);
        }

        async function viewDetail(pid) {
            currentPid = pid; showPage('detailPage');
            if(countdownTimer) clearInterval(countdownTimer);
            
            document.getElementById("pollInfo").innerHTML = `<h2>è®€å–éˆä¸Šæ•¸æ“šä¸­...</h2>`;
            try {
                const p = await contract.allPolls(pid);
                const candidates = await contract.getCandidates(pid);
                await syncUserDashboard();

                const modeNames = ["ä¸€èˆ¬", "å¹³æ–¹ (QV)", "å‹Ÿè³‡ (QF)", "æ’åº (Ranked)", "æ¬Šé‡"];
                
                const updateCountdown = () => {
                    const now = Math.floor(Date.now() / 1000);
                    const diff = p.endTime.toNumber() - now;
                    let countdownHtml = "";
                    
                    if(diff <= 0) {
                        countdownHtml = `<b style="color:var(--error)">æŠ•ç¥¨å·²æˆªæ­¢</b>`;
                        if(countdownTimer) clearInterval(countdownTimer);
                    } else {
                        const d = Math.floor(diff / 86400);
                        const h = Math.floor((diff % 86400) / 3600);
                        const m = Math.floor((diff % 3600) / 60);
                        const s = diff % 60;
                        countdownHtml = `
                            <div class="countdown-wrap">
                                <div class="count-unit"><span class="count-val">${d}</span><span class="count-lbl">D</span></div>
                                <div class="count-unit"><span class="count-val">${h}</span><span class="count-lbl">H</span></div>
                                <div class="count-unit"><span class="count-val">${m}</span><span class="count-lbl">M</span></div>
                                <div class="count-unit"><span class="count-val">${s}</span><span class="count-lbl">S</span></div>
                            </div>
                        `;
                    }
                    
                    document.getElementById("pollInfo").innerHTML = `
                        <div style="display:flex; justify-content:space-between; align-items:start;">
                            <div><span class="cost-tag">#${pid}</span><h1>${p.topic}</h1></div>
                            <span class="cost-tag" style="background:rgba(255,255,255,0.1)">${modeNames[p.mode]}æ¨¡å¼</span>
                        </div>
                        <div style="margin-top:10px;">${countdownHtml}</div>
                        <p style="font-size:0.8rem; color:var(--muted); margin-top:15px;">ç™¼èµ·åœ°å€ï¼š${p.creator}</p>`;
                };
                
                updateCountdown();
                countdownTimer = setInterval(updateCountdown, 1000);
                
                const isCreator = p.creator.toLowerCase() === userAddr.toLowerCase();
                const canEdit = isCreator && p.totalVotes.toNumber() === 0;
                document.getElementById("creatorEditSection").style.display = canEdit ? "block" : "none";
                if(canEdit) {
                    document.getElementById("editTopic").value = p.topic;
                    const container = document.getElementById("editCandidatesContainer");
                    container.innerHTML = candidates.map((c, i) => `
                        <div class="edit-card-row">
                            <div class="edit-flex"><input type="text" class="edit-cand-name" value="${c.name}"><input type="text" id="edit-uid-${i}" class="edit-cand-uid" value="${c.uid}"></div>
                            <label class="file-label" for="edit-file-${i}"><i class="fa-solid fa-camera"></i> æ›´æ›åœ–ç‰‡</label>
                            <input type="file" id="edit-file-${i}" style="display:none" onchange="processImageUpload(this, 'edit-uid-${i}')">
                        </div>`).join('');
                }

                const oracleGuess = document.getElementById("oracleGuess");
                oracleGuess.innerHTML = candidates.map((c, i) => `<option value="${i}">${c.name}</option>`).join('');

                document.getElementById("qvUserStats").style.display = (p.mode === 1) ? "block" : "none";
                if(p.mode === 1) document.getElementById("remainingCreditsText").innerText = `å¯ç”¨é»æ•¸ï¼š${userCredits} é»`;

                const vUI = document.getElementById("votingUI");
                vUI.innerHTML = candidates.map((c, i) => `
                    <div class="card" style="text-align:center">
                        <div class="cand-img-wrap"><img src="${resolveCandidateImage(c.uid)}" class="cand-img" onerror="this.src='https://via.placeholder.com/220?text=Wait+IPFS'"></div>
                        <h3>${c.name}</h3><p>å·²ç´¯ç©: ${c.voteWeight.toString()} ç¥¨</p>
                        ${p.mode === 1 ? `
                            <input type="number" id="qv-input-${i}" placeholder="æŠ•ç¥¨æ•¸" min="1" oninput="updateQVCost(${i})">
                            <div id="qv-cost-${i}" class="qv-info">è€—ï¼š0 é»</div>
                            <button onclick="handleCastVote(${pid}, ${i}, 1)">å¹³æ–¹æŠ•ç¥¨</button>
                        ` : `<button onclick="handleCastVote(${pid}, ${i}, 0)">æŠ•ä¸‹ä¸€ç¥¨</button>`}
                    </div>`).join('');
            } catch (e) { notify("æŠ“å–å¤±æ•—", "error"); }
        }

        function updateQVCost(idx) {
            const v = document.getElementById(`qv-input-${idx}`).value || 0;
            const cost = v * v;
            const el = document.getElementById(`qv-cost-${idx}`);
            el.innerText = `é è¨ˆæ¶ˆè€—ï¼š${cost} é»`;
            el.style.color = cost > userCredits ? "var(--error)" : "var(--warning)";
        }

        async function handleCastVote(pid, cid, type) {
            if(!isRegisteredOnChain) return notify("è«‹å…ˆè¨»å†Šèº«åˆ†", "error");
            let val = parseInt((type === 1) ? document.getElementById(`qv-input-${cid}`).value : "1");
            if (isNaN(val) || val <= 0) return notify("ç¥¨æ•¸éŒ¯èª¤", "warning");
            if (type === 1 && val * val > userCredits) return notify("é»æ•¸ä¸è¶³", "error");

            try {
                notify("æ‰“åŒ…é¸ç¥¨ä¸­...", "info");
                const tx = await contract.castVote(pid, cid, val);
                await tx.wait();
                confetti(); viewDetail(pid);
                notify("æŠ•ç¥¨æˆåŠŸï¼æ•¸æ“šå·²æŒä¹…åŒ–", "success");
            } catch (e) { notify("äº¤æ˜“ç•°å¸¸ï¼Œè«‹æª¢æŸ¥é¤˜é¡", "error"); }
        }

        async function handleOracleBet() {
            notify("é è¨€å·²è¨˜éŒ„æ–¼æœ¬åœ°æŒä¹…å±¤ï¼ŒçŒœå°çå‹µ +50 Repï¼", "success");
        }

        async function handleEditPollMetadata() {
            try {
                notify("åŸ·è¡Œéˆä¸Šæ›´æ–°...", "info");
                const newT = document.getElementById("editTopic").value;
                const ns = Array.from(document.querySelectorAll(".edit-cand-name")).map(i => i.value);
                const us = Array.from(document.querySelectorAll(".edit-cand-uid")).map(i => i.value);
                const tx = await contract.updatePollMetadata(currentPid, newT, ns, us);
                await tx.wait(); notify("æ›´æ–°æˆåŠŸ", "success"); viewDetail(currentPid);
            } catch (e) { notify("ä¿®æ”¹å¤±æ•—", "error"); }
        }

        async function handleDeletePoll() {
            if(!confirm("ç¢ºå®šè¦åˆªé™¤æ­¤ææ¡ˆå—ï¼Ÿ")) return;
            try {
                notify("æ¨™è¨˜åˆªé™¤ä¸­...", "info");
                const tx = await contract.updatePollMetadata(currentPid, "[DELETED] " + document.getElementById("editTopic").value, [], []);
                await tx.wait();
                notify("ææ¡ˆå·²æˆåŠŸéš±è—", "success");
                showPage('listPage');
                renderPolls();
            } catch (e) { notify("æ¬Šé™ä¸è¶³", "error"); }
        }

        async function handleCreatePoll() {
            if(!isRegisteredOnChain) return notify("è«‹å…ˆå®Œæˆè¨»å†Š", "error");
            const btn = document.getElementById("submitCreateBtn");
            const days = parseInt(document.getElementById("dur-days").value) || 0;
            const hours = parseInt(document.getElementById("dur-hours").value) || 0;
            const mins = parseInt(document.getElementById("dur-mins").value) || 0;
            const totalMinutes = (days * 1440) + (hours * 60) + mins;

            const topic = document.getElementById("topic").value;
            const ns = Array.from(document.querySelectorAll(".cand-name")).map(i => i.value);
            const us = Array.from(document.querySelectorAll(".cand-uid")).map(i => i.value);
            
            if(!topic || ns.length < 2) return notify("è³‡è¨Šä¸å…¨", "error");
            try {
                btn.disabled = true; btn.innerText = "æ‰“åŒ…äº¤æ˜“ä¸­...";
                const tx = await contract.createPoll(topic, document.getElementById("modeSelect").value, ns, us, Math.ceil(totalMinutes || 60));
                await tx.wait(); confetti(); renderPolls(); showPage('listPage');
            } catch (e) { notify("ç™¼èµ·å¤±æ•—", "error"); } finally { btn.disabled = false; btn.innerText = "ç™¼é€äº¤æ˜“"; }
        }

        async function handleRegisterOnChain() {
            try {
                notify("è¨»å†Šä¸­...", "info");
                const tx = await contract.register("Governance_User", "default");
                await tx.wait(); confetti(); await syncUserDashboard(); updateUI();
                notify("èº«åˆ†è¨»å†ŠæˆåŠŸï¼", "success");
            } catch (e) { notify("è¨»å†Šç•°å¸¸", "error"); }
        }

        async function renderPolls() {
            const grid = document.getElementById("pollGrid");
            if(!contract) return;
            try {
                const count = await contract.getPollCount();
                let html = "";
                for(let i = count.toNumber() - 1; i >= 0; i--) {
                    const p = await contract.allPolls(i);
                    if (p.topic.startsWith("[DELETED]")) continue;
                    html += `<div class="card" onclick="viewDetail(${i})"><span class="cost-tag">#${i}</span><h3>${p.topic}</h3><p style="color:var(--muted)">ç´¯è¨ˆç¥¨æ•¸ï¼š${p.totalVotes.toString()}</p><button class="btn-ghost" style="width:100%; margin-top:15px;">é€²å…¥æŠ•ç¥¨</button></div>`;
                }
                grid.innerHTML = html || '<p>å°šç„¡è­°æ¡ˆ</p>';
            } catch (e) { }
        }

        function loadPersistedData() {
            const t = localStorage.getItem(`titles_${userAddr}`);
            userTitles = t ? JSON.parse(t) : [];
        }
        function savePersistedData() { if(userAddr) localStorage.setItem(`titles_${userAddr}`, JSON.stringify(userTitles)); }

        function updateUI() {
            if (!userAddr) return;
            document.getElementById("navName").innerText = userAddr.substring(0, 6) + "...";
            document.getElementById("navAvatar").src = `https://api.dicebear.com/7.x/identicon/svg?seed=${userAddr}`;
            document.getElementById("profileAvatar").src = `https://api.dicebear.com/7.x/identicon/svg?seed=${userAddr}`;
            document.getElementById("navRep").innerText = "Rep: " + userRep;
            let lvl = "ğŸŒ± æ²»ç†èŒèŠ½"; let fill = (userRep / 50) * 100;
            if (userRep > 50) { lvl = "ğŸ›¡ï¸ æ²»ç†åŸ·æ³•è€…"; fill = ((userRep - 50) / 100) * 100; }
            if (userRep > 150) { lvl = "ğŸ‘‘ æ²»ç†å‚³å¥‡"; fill = ((userRep - 150) / 350) * 100; }
            document.getElementById("lvlTitle").innerText = "ç­‰ç´šï¼š" + lvl;
            document.getElementById("lvlFill").style.width = Math.min(fill, 100) + "%";
            document.getElementById("repStatus").innerText = `Reputation: ${userRep}`;
            const wall = document.getElementById("titleCollection");
            if (userTitles.length > 0) wall.innerHTML = userTitles.map(t => `<span class="title-badge">${t}</span>`).join('');
            savePersistedData();
        }

        function handleDailyCheckIn() { userRep += 10; notify("ç°½åˆ°æˆåŠŸï¼Rep +10", "success"); updateUI(); confetti(); }
        
        function spinWheel() {
            const deg = 1800 + Math.random() * 1800;
            const wheel = document.getElementById("wheel");
            if(!wheel) return;
            wheel.style.transform = `rotate(${deg}deg)`;
            const results = [{t:"ç¨±è™Ÿï¼šå…±è­˜å¤§å¸«",v:"å…±è­˜å¤§å¸«"},{t:"ç¨±è™Ÿï¼šæ²»ç†å…ˆé‹’",v:"æ²»ç†å…ˆé‹’"},{t:"ç¨±è™Ÿï¼šçœŸç†ä¹‹çœ¼",v:"çœŸç†ä¹‹çœ¼"}];
            setTimeout(() => {
                const res = results[Math.floor(Math.random() * results.length)];
                document.getElementById("wheelResult").innerText = res.t;
                if(res.v && !userTitles.includes(res.v)) { userTitles.push(res.v); updateUI(); }
                confetti();
            }, 4000);
        }

        function disconnectWallet() { 
            sessionStorage.setItem('explicitLogout', 'true'); 
            userAddr = null; 
            isRegisteredOnChain = false;
            document.getElementById("userInfo").style.display = "none";
            document.getElementById("connBtn").style.display = "block";
            document.getElementById("discoBtn").style.display = "none";
            document.getElementById("netStatus").innerText = "å°šæœªé€£æ¥";
            document.getElementById("netStatus").classList.remove("net-ok");
            notify("å·²å¾¹åº•æ–·é–‹é€£æ¥", "info");
            setTimeout(() => location.reload(), 500);
        }

        function showPage(id) {
            document.querySelectorAll('.page').forEach(p => p.classList.remove('active'));
            document.getElementById(id).classList.add('active');
            if (id == 'statPage') initChart();
            window.scrollTo(0, 0);
        }

        function notify(m, t) {
            const c = document.getElementById("toast-container");
            const div = document.createElement("div"); div.className = "toast";
            div.style.borderLeftColor = t == 'error' ? 'var(--error)' : 'var(--p)';
            div.innerText = m; c.appendChild(div); setTimeout(() => div.remove(), 4000);
        }

        function initChart() {
            const ctx = document.getElementById('mainChart').getContext('2d');
            if (chartInstance) chartInstance.destroy();
            chartInstance = new Chart(ctx, { type: 'line', data: { labels: ['1æœˆ', '2æœˆ'], datasets: [{ label: 'ç¥¨æ•¸è¶¨å‹¢', data: [310, 450], borderColor: '#6366f1' }] } });
        }

        function filterPolls() {
            const q = document.getElementById("searchBar").value.toLowerCase();
            document.querySelectorAll('#pollGrid .card').forEach(c => {
                c.style.display = c.innerText.toLowerCase().includes(q) ? 'block' : 'none';
            });
        }

        window.onload = () => { 
            init(); 
            addCandidateInput(); addCandidateInput(); 
        };
    </script>
</body>

</html>
